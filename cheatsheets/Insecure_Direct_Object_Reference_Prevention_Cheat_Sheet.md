# Шпаргалка по предотвращению Прямых Ненадежных Ссылок на Объекты (IDOR)

## Введение

Прямая ненадежная ссылка на объект (IDOR) — это уязвимость, которая возникает, когда злоумышленники могут получить доступ к объектам или изменить их, манипулируя идентификаторами, используемыми в URL или параметрах веб-приложения. Она возникает из-за отсутствия проверок контроля доступа, которые не подтверждают, имеет ли пользователь право на доступ к конкретным данным.

## Примеры

Например, когда пользователь заходит в свой профиль, приложение может создать URL такого вида:

```
https://example.org/users/123
```

Число 123 в URL является прямой ссылкой на запись пользователя в базе данных, часто представленное первичным ключом. Если злоумышленник изменяет это число на 124 и получает доступ к информации другого пользователя, приложение уязвимо для IDOR. Это происходит потому, что приложение не проверило, имеет ли пользователь разрешение на просмотр данных пользователя 124 перед их отображением.

В некоторых случаях идентификатор может находиться не в URL, а в POST-данных, как показано в следующем примере:

```
<form action="/update_profile" method="post">
  <!-- Другие поля для обновления имени, email и т.д. -->
  <input type="hidden" name="user_id" value="12345">
  <button type="submit">Обновить профиль</button>
</form>
```

В этом примере приложение позволяет пользователям обновлять свои профили, отправляя форму с идентификатором пользователя в скрытом поле. Если приложение не выполняет надлежащую проверку контроля доступа на стороне сервера, злоумышленники могут манипулировать полем "user_id" для изменения профилей других пользователей без разрешения.

## Сложность идентификаторов

В некоторых случаях использование более сложных идентификаторов, таких как GUID, может сделать практически невозможным для злоумышленников угадывание допустимых значений. Однако даже с сложными идентификаторами проверки контроля доступа необходимы. Если злоумышленники получают URL для неавторизованных объектов, приложение должно блокировать их попытки доступа.

## Меры по предотвращению

Для предотвращения IDOR реализуйте проверки контроля доступа для каждого объекта, к которому пользователи пытаются получить доступ. Веб-фреймворки часто предоставляют способы упрощения этого процесса. Кроме того, используйте сложные идентификаторы в качестве дополнительной меры защиты, но помните, что контроль доступа остается критически важным, даже при использовании таких идентификаторов.

Избегайте раскрытия идентификаторов в URL и POST-данных, если это возможно. Вместо этого определяйте текущего аутентифицированного пользователя по информации о сессии. При использовании многоступенчатых потоков передавайте идентификаторы в сессии, чтобы предотвратить их подделку.

При поиске объектов по первичным ключам используйте наборы данных, к которым у пользователей есть доступ. Например, в Ruby on Rails:

```
# Уязвимо, ищет все проекты
@project = Project.find(params[:id])
# Безопасно, ищет проекты, связанные с текущим пользователем
@project = @current_user.projects.find(params[:id])
```

Проверяйте разрешение пользователя каждый раз, когда осуществляется попытка доступа. Реализуйте это структурно, используя рекомендованный подход для вашего веб-фреймворка.

В качестве дополнительной меры защиты замените числовые идентификаторы на более сложные, случайные идентификаторы. Это можно сделать, добавив колонку со случайными строками в таблицу базы данных и используя эти строки в URL вместо числовых первичных ключей. Еще одним вариантом является использование UUID или других длинных случайных значений в качестве первичных ключей. Избегайте шифрования идентификаторов, так как это может быть сложно сделать безопасно.
