# Шпаргалка по защите от атак типа "отказ в обслуживании" (DoS)

## Введение

Эта памятка описывает методологию для защиты от атак типа "отказ в обслуживании" (DoS) на различных уровнях. Она также служит платформой для дальнейшего обсуждения и анализа, так как существует множество способов выполнения DoS-атак.

### Основные принципы

Поскольку методы защиты от DoS не могут быть одноступенчатыми решениями, разработчики и архитекторы приложений/инфраструктуры должны тщательно разрабатывать DoS-решения. Им необходимо помнить, что "доступность" — это основная часть [триады CIA](https://whatis.techtarget.com/definition/Confidentiality-integrity-and-availability-CIA).

Помните, что если любая часть вычислительной системы в потоке взаимодействия не функционирует правильно, ваша инфраструктура страдает. Успешная DoS-атака снижает доступность экземпляров или объектов для системы и в конечном итоге может сделать всю систему недоступной.

**Для обеспечения устойчивости систем к DoS-атакам, настоятельно рекомендуется тщательный анализ компонентов в вашем инвентаре на основе их функциональности, архитектуры и производительности (например, приложения, инфраструктура и сеть).**

![DDOSFlow](../assets/Denial_of_Service_Cheat_Sheet_FlowDDOS.png)

Этот инвентарь системы DoS должен искать потенциальные места, где DoS-атаки могут вызвать проблемы, и выявлять любые одиночные точки отказа системы, которые могут варьироваться от программных ошибок до исчерпания ресурсов. Он должен дать вам четкое представление о том, какие проблемы стоят на кону (например, узкие места и т. д.). **Для решения проблем важно хорошо понимать вашу среду, чтобы разработать соответствующие защитные механизмы**, которые могут быть согласованы с:

1. Опциями масштабирования (**вертикального** = внутренние компоненты оборудования, **горизонтального** = количество полных компонентов).
2. Существующими концептуальными/логическими техниками (например, применением мер по повышению отказоустойчивости, ограничению распространения отказов и т. д.).
3. Анализом затрат, примененным к вашей ситуации.

Этот документ использует структуру руководства CERT-EU для анализа данной темы, которую вам, возможно, придется изменить в зависимости от вашей ситуации. Это не полное решение, но оно поможет вам создать фундаментальные блоки, которые следует использовать для создания концепции защиты от DoS, соответствующей вашим потребностям.

### Анализ поверхностей атак DoS

В этой памятке мы будем использовать классификацию DDOS, задокументированную CERT-EU, для анализа уязвимостей систем по DoS. Она использует семь уровней модели OSI и фокусируется на трёх основных поверхностях атаки: приложения, сеансы и сеть.

#### 1) Обзор потенциальных уязвимостей DoS

Важно понимать, что каждую из этих трёх категорий атак необходимо учитывать при проектировании решения, устойчивого к DoS:

**Атаки на приложения** направлены на то, чтобы сделать приложения недоступными путём исчерпания ресурсов или нарушением их функциональности.

**Атаки на сеансы (или протоколы)** фокусируются на потреблении ресурсов сервера или промежуточных устройств, таких как межсетевые экраны и балансировщики нагрузки.

**Сетевые атаки (или объёмные)** направлены на насыщение пропускной способности сетевого ресурса.

Обратите внимание, что уровни 1 и 2 модели OSI не включены в эту категоризацию, поэтому теперь мы обсудим эти уровни и то, как DoS применяется к ним.

**Физический уровень** состоит из технологий передачи данных сетевого оборудования. Это фундаментальный уровень, лежащий в основе логических структур данных высших функций в сети. Типичные сценарии DoS, включающие физический уровень, включают разрушение, блокирование или нарушение работы системы. Например, пожилая женщина в Грузии перерезала подземный кабель, что привело к потере интернета по всей Армении.

**Канальный уровень** — это уровень протокола, который передаёт данные между соседними узлами сети в глобальной сети (WAN) или между узлами в одном сегменте локальной сети (LAN). Типичные сценарии DoS на этом уровне включают затопление MAC-адресов (целевая таблица MAC-коммутатора) и отравление ARP.

При **атаках затопления MAC** коммутатор затапливается пакетами с различными исходными MAC-адресами. Цель этой атаки — израсходовать ограниченную память, используемую коммутатором для хранения таблицы преобразования MAC-адресов и физических портов (MAC-таблицы), что приводит к удалению допустимых MAC-адресов и переводу коммутатора в режим отказа, при котором он становится сетевым хабом. В этом случае все данные пересылаются на все порты, что приводит к утечке данных.

[Будущие дополнения к памятке: Влияние на отказ в обслуживании и рекомендации по смягчению последствий]

При **атаках отравления ARP** злоумышленник отправляет поддельные сообщения ARP (протокол разрешения адресов) по сети. Если MAC-адрес злоумышленника связывается с IP-адресом законного устройства в сети, злоумышленник может перехватывать, изменять или блокировать данные, предназначенные для IP-адреса жертвы. Протокол ARP специфичен для локальной сети и может вызвать отказ в обслуживании по проводу.

Технология фильтрации пакетов может использоваться для инспекции пакетов в транзите для выявления и блокировки вредоносных пакетов ARP. Другим подходом является использование статических таблиц ARP, но их трудно поддерживать.

## Атаки на приложения

**Атаки на уровне приложений обычно делают приложения недоступными путём исчерпания системных ресурсов или нарушением их функциональности.** Эти атаки не обязательно должны потреблять полосу пропускания сети, чтобы быть эффективными. Скорее, они создают операционную нагрузку на сервер приложения таким образом, что сервер становится недоступным, неработоспособным или нефункциональным. Все атаки, использующие уязвимости на уровне 7 протокольного стека OSI, в целом относятся к атакам на приложения. Они являются самыми сложными для выявления/смягчения.

[Будущие дополнения к памятке: Перечислите все атаки по категориям. Поскольку мы не можем сопоставить контрмеры один к одному с векторами атак, нам сначала нужно перечислить их, прежде чем обсуждать шаги действий.]

**Медленные HTTP-атаки отправляют HTTP-запросы очень медленно и фрагментированно, по одному. Пока HTTP-запрос полностью не передан, сервер будет держать ресурсы в ожидании недостающих входных данных.** В какой-то момент сервер достигнет максимального пула одновременных соединений, что приведёт к DoS. С точки зрения атакующего, медленные HTTP-атаки дешевы в выполнении, так как требуют минимальных ресурсов.

### Концепции проектирования ПО

- **Использование валидации, которая требует минимальных ресурсов, на первом этапе**: Мы хотим минимизировать воздействие на ресурсы как можно раньше. Более ресурсоёмкие (CPU, память и полоса пропускания) проверки должны выполняться позже.
- **Применение плавной деградации**: Это ключевая концепция на этапе проектирования приложений, чтобы минимизировать влияние DoS. Важно сохранять некоторый уровень функциональности при сбоях частей системы или приложения. Одна из основных проблем DoS заключается в том, что атаки вызывают резкие и внезапные завершения работы приложений по всей системе. Отказоустойчивый дизайн позволяет системе или приложению продолжать работу, пусть и на сниженном уровне, а не полностью выходить из строя при сбоях отдельных компонентов.
- **Предотвращение одиночных точек отказа**: Выявление и предотвращение одиночных точек отказа (SPOF) является ключевым для защиты от DoS-атак. Большинство DoS-атак предполагают наличие в системе SPOF, которые могут выйти из строя из-за перегрузки. Мы рекомендуем использовать бесстатусные компоненты, внедрять избыточные системы, создавать механизмы изоляции, чтобы предотвратить распространение сбоев по инфраструктуре, и гарантировать, что системы смогут продолжить работу при отказе внешних сервисов. [Предотвращение](https://www.baeldung.com/cs/distributed-systems-prevent-single-point-failure)
- **Избегайте операций с высокой загрузкой процессора**: В случае DoS-атаки операции, которые требуют большого количества процессорных ресурсов, могут значительно замедлить работу системы и стать точкой отказа. Мы настоятельно рекомендуем провести обзор проблем с производительностью в вашем коде, включая проблемы, характерные для вашего стека технологий.
- **Многопоточность**: Избегайте операций, которые требуют завершения крупных задач для продолжения работы. Асинхронные операции полезны в таких ситуациях.
- Определите ресурсоемкие страницы и планируйте заранее.

### Сессии

- **Ограничение времени сессии на стороне сервера на основе неактивности и финального тайм-аута**: (исчерпание ресурсов) Хотя время завершения сессии чаще всего обсуждается в контексте безопасности сессий и предотвращения перехвата сессий, это также важная мера для предотвращения исчерпания ресурсов.
- **Ограничение хранения информации, связанной с сессией**: Чем меньше данных связано с сессией, тем меньшую нагрузку пользовательская сессия оказывает на производительность веб-сервера.

### Валидация ввода

- **Ограничение размера загрузки файлов и расширений**: Эта тактика предотвращает DoS на файловое пространство хранения или другие функции веб-приложений, которые будут использовать загрузку в качестве входных данных (например, изменение размера изображений, создание PDF и т. д. (исчерпание ресурсов) - [Контрольный список](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)).
- **Ограничение общего размера запроса**: Это затрудняет успешное выполнение DoS-атак, потребляющих ресурсы. (исчерпание ресурсов)
- **Предотвращение выделения ресурсов на основе ввода**: Снова, чтобы усложнить успешное выполнение DoS-атак, потребляющих ресурсы. (исчерпание ресурсов)
- **Предотвращение взаимодействия функций и потоков на основе ввода**: Ввод пользователя может влиять на количество раз, которое функция должна быть выполнена, или на интенсивность использования процессора. Зависимость от (нефильтрованного) ввода пользователя для выделения ресурсов может позволить сценарий DoS через исчерпание ресурсов. (исчерпание ресурсов)
- **Пазлы на основе ввода**, такие как капчи или простые математические задачи, часто используются для "защиты" веб-форм. Классический пример - веб-форма, которая отправляет электронное письмо после отправки запроса. Капча может предотвратить переполнение почтового ящика злонамеренным атакующим или спам-ботом. **Пазлы служат цели против злоупотребления функциональностью, но такая технология не поможет защититься от DoS-атак.**

### Контроль доступа

- **Аутентификация как способ раскрытия функциональности**: Принцип наименьших привилегий может сыграть ключевую роль в предотвращении DoS-атак, отказывая атакующим в доступе к потенциально опасным функциям с использованием техник DoS.
- **Блокировка пользователей** - это сценарий, когда атакующий может воспользоваться механизмами безопасности приложения для создания DoS, злоупотребляя неудачами входа в систему.

## Сетевые атаки

Для получения дополнительной информации о сетевых атаках см.:

[Juniper](https://www.juniper.net/documentation/us/en/software/junos/denial-of-service/topics/topic-map/security-network-dos-attack.html)  
[eSecurityPlanet](https://www.esecurityplanet.com/networks/types-of-ddos-attacks/)

[Будущие дополнения к памятке: Обсудите атаки, когда пропускная способность сети достигает насыщения. Объемные по своей природе. Техники усиления делают эти атаки эффективными. Перечислите атаки: усиление NTP, усиление DNS, затопление UDP, затопление TCP]

### Концепции проектирования сети

- **Предотвращение одиночной точки отказа**: См. выше.
- **Кэширование**: Концепция хранения данных, чтобы будущие запросы к этим данным могли обслуживаться быстрее. Чем больше данных обслуживается через кэширование, тем более устойчивым приложение становится к исчерпанию пропускной способности.
- **Хостинг статических ресурсов на другом домене** уменьшит количество HTTP-запросов на веб-приложение. Изображения и JavaScript являются типичными файлами, загружаемыми с другого домена.

### Ограничение частоты запросов

Ограничение частоты запросов - это процесс контроля скорости трафика от и к серверу или компоненту. Оно может быть реализовано как на уровне инфраструктуры, так и на уровне приложения. Ограничение частоты запросов может основываться на (нарушителях) IP-адресах, списках блокировок IP, геолокации и т. д.

- **Определите минимальную скорость входящего трафика** и сбрасывайте все соединения ниже этого уровня. Обратите внимание, что если лимит установлен слишком низко, это может повлиять на клиентов. Проверьте журналы, чтобы установить базовый уровень подлинного трафика. (Защита от медленных HTTP-атак)
- **Определите абсолютный тайм-аут соединения**
- **Определите максимальную скорость входящего трафика**, затем сбрасывайте все соединения выше этого уровня.
- **Определите общий лимит пропускной способности**, чтобы предотвратить исчерпание пропускной способности.
- **Определите лимит нагрузки**, который указывает количество пользователей, которым разрешено получать доступ к любому данному ресурсу в любое время.

### Меры на уровне провайдера интернета (ISP)

- **Фильтрация недопустимых адресов отправителей с использованием крайних маршрутизаторов**, в соответствии с RFC 2267, для фильтрации атак с подделкой IP-адресов с целью обхода списков блокировок.
- **Проверьте услуги вашего провайдера интернета в отношении DDOS заранее** (поддержка нескольких точек доступа в интернет, достаточная пропускная способность (xx-xxx Gбит/с) и специальное оборудование для анализа трафика и защиты на уровне приложения).

### Меры на глобальном уровне: коммерческие фильтрующие сервисы облака

- Рассмотрите возможность использования фильтрующего сервиса для защиты от более крупных атак (до 500 Гбит/с).
- **Фильтрующие сервисы** поддерживают различные механизмы для фильтрации вредоносного или несоответствующего трафика.
- **Соблюдайте соответствующие законы о защите данных/конфиденциальности** - многие провайдеры маршрутизируют трафик через США/Великобританию.

## Связанные статьи

- [Публикация CERT-EU](http://cert.europa.eu/static/WhitePapers/CERT-EU-SWP_14_09_DDoS_final.pdf)