<!---
Copyright 2021 Nokia
Licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License
SPDX-License-Identifier: CC-BY-SA-3.0
--->

# Руководство по безопасности Infrastructure as Code

## Введение

Infrastructure as Code (IaC), также известная как программно определенная инфраструктура, позволяет быстрее настраивать и развертывать инфраструктурные компоненты с консистентностью, позволяя определять их как код, а также обеспечивает повторяемость развертываний между средами.

### Лучшие практики безопасности

Вот некоторые лучшие практики безопасности для IaC, которые можно легко интегрировать в жизненный цикл разработки программного обеспечения:

### Разработка и Распространение

- **Плагины IDE** - Используйте стандартные плагины безопасности в интегрированной среде разработки (IDE), которые помогают в раннем обнаружении потенциальных рисков и значительно сокращают время на устранение проблем в дальнейшем цикле разработки. Плагины, такие как TFLint, Checkov, Docker Linter, docker-vulnerability-extension, Security Scan, Contrast Security и другие, помогают в оценке безопасности IaC.
- **Моделирование угроз** - Создайте ландшафт моделирования угроз раньше в цикле разработки, чтобы обеспечить достаточную видимость высоких рисков и объема кода, а также гибкость для включения безопасности на протяжении всего процесса для безопасного управления активами.
- **Управление секретами** - Секреты - это конфиденциальные данные и информация, такие как токены приложений, требуемые для аутентификации, пароли и ключи SSH (Secure Shell). Проблема не в самих секрете, а в том, где вы их храните. Если вы используете простой текстовый файл или системы управления версиями, такие как Git, то секреты могут быть легко раскрыты. Открытые инструменты, такие как truffleHog, git-secrets, GitGuardian и аналогичные, могут быть использованы для обнаружения уязвимого управления секретами. См. [Шпаргалку по по управлению секретами](Secrets_Management_Cheat_Sheet.md) для получения дополнительной информации.
- **Управление версиями** - Управление версиями - это практика отслеживания и управления изменениями в исходном коде программного обеспечения. Убедитесь, что все изменения в IaC отслеживаются с правильным набором информации, что помогает в любых операциях отката. Важно проверять эти изменения вместе с функциями, которые они поддерживают, а не отдельно. Требования к инфраструктуре функции должны быть частью ветки функции или запроса на слияние. Git обычно используется как система управления версиями исходного кода.
- **Принцип наименьших привилегий** - Определите политики управления доступом на основе принципа наименьших привилегий с учетом следующих приоритетов:

    - Определение, кто уполномочен создавать/обновлять/запускать/удалять скрипты и инвентарь, а кто нет.
    - Ограничение прав авторизованных пользователей IaC до того, что необходимо для выполнения их задач. Скрипты IaC должны обеспечивать, чтобы права, предоставленные различным ресурсам, которые они создают, были ограничены тем, что необходимо для их работы.

- **Статический анализ** - Анализирует код в изоляции, выявляя риски, неправильные конфигурации и ошибки соответствия, которые относятся только к IaC. Инструменты, такие как kubescan, Snyk, Coverity и другие, могут быть использованы для статического анализа IaC.
- **Проверка зависимостей с открытым исходным кодом** - Анализирует зависимости с открытым исходным кодом, такие как пакеты ОС, библиотеки и т. д., чтобы выявить потенциальные риски. Инструменты, такие как BlackDuck, Snyk, WhiteSource Bolt для GitHub и аналогичные, могут быть использованы для анализа зависимостей с открытым исходным кодом в IaC.
- **Сканирование образов контейнеров** - Сканирование образов относится к процессу анализа содержимого и процесса сборки образа контейнера для обнаружения проблем безопасности, уязвимостей или потенциальных рисков. Открытые инструменты, такие как Dagda, Clair, Trivy, Anchore и другие, могут быть использованы для анализа образов контейнеров.
- **CI/CD pipeline и консолидированное отчетность** - Включение проверок безопасности в CI/CD pipeline позволяет анализировать каждое изменение кода, исключает необходимость ручного вмешательства и поддерживает историю соблюдения требований. Вместе с консолидированным отчетом такие интеграции увеличивают скорость разработки безопасной базы кода IaC. Открытые инструменты, такие как Jenkins и другие, могут быть использованы для построения CI/CD pipeline, а DefectDojo и OWASP Glue могут помочь связать проверки и визуализировать результаты проверок на одной панели управления.
- **Подпись артефактов** - Цифровая подпись артефактов во время сборки и проверка подписанных данных перед использованием защищает артефакты от подделки между сборкой и временем выполнения, тем самым обеспечивая целостность и происхождение артефакта. Открытые инструменты, такие как TUF, помогают в цифровой подписи артефактов.

### Развертывание

- **Управление инвентарем**:
    - **Комиссия** - при развертывании ресурса убедитесь, что ресурс помечен, отслеживается и регистрируется в рамках управления инвентарем.
    - **Деактивация** - при инициации удаления ресурса убедитесь, что базовые конфигурации стираются, данные безопасно удаляются, а ресурс полностью удаляется как из рабочей среды, так и из управления инвентарем.
    - **Тегирование** - Крайне важно правильно тегировать облачные активы. Во время операций IaC, не помеченные активы скорее всего приведут к появлению «призрачных» ресурсов, которые трудно обнаружить, визуализировать и получить видимость в облачной среде, что может повлиять на безопасность, вызывая отклонения. Эти призрачные ресурсы могут увеличить затраты на выставление счетов, усложнить обслуживание и повлиять на надежность. Единственным решением является тщательное тегирование и мониторинг нетегированных ресурсов.
- **Динамический анализ** - Динамический анализ помогает оценить любые существующие среды и службы, с которыми IaC будет взаимодействовать или на которых будет работать. Это помогает выявить потенциальные риски из-за совместимости. Открытые инструменты, такие как ZAP, Burp, GVM и другие, могут быть использованы для динамического анализа.

### Время выполнения

- **Невозможность изменения инфраструктуры** - Идея неизменяемой инфраструктуры заключается в создании компонентов инфраструктуры в точном соответствии с заданными спецификациями. Никаких отклонений, никаких изменений. Если требуется изменение спецификации, то создается новый набор инфраструктуры на основе обновленных требований, а предыдущая инфраструктура выводится из эксплуатации как устаревшая.
- **Логирование** - Ведение записей является критическим аспектом для мониторинга рисков. Необходимо включить логирование - как логирование безопасности, так и аудита - во время развертывания инфраструктуры, так как это помогает оценивать риски безопасности, связанные с чувствительными активами. Оно также помогает в анализе коренных причин инцидентов и в выявлении потенциальных угроз. Открытые инструменты, такие как ELK и другие, могут быть использованы для анализа логов.
- **Мониторинг** - Непрерывный мониторинг помогает выявлять нарушения безопасности и соблюдения требований, помогает в обнаружении атак и также предоставляет уведомления при таких инцидентах. Некоторые решения также включают новые технологии, такие как ИИ, для раннего обнаружения потенциальных угроз. Открытые инструменты, такие как Prometheus, Grafana и другие, могут быть использованы для мониторинга облачной инфраструктуры.
- **Обнаружение угроз в реальном времени** - Реализация решения для обнаружения угроз в реальном времени помогает распознавать неожиданное поведение приложений и предупреждает о угрозах во время выполнения. Открытые инструменты, такие как Falco и другие, могут быть использованы для обнаружения угроз в реальном времени. Некоторые приложения, такие как Contrast (Contrast Community Edition), также могут обнаруживать атаки OWASP Top 10 на приложение во время выполнения и помогать блокировать их, чтобы защитить и обезопасить приложение.

## Ссылки

- Безопасность Infrastructure as Code: <https://www.opcito.com/blogs/securing-infrastructure-as-code>
- Безопасность Infrastructure as Code: <https://dzone.com/articles/infrastructure-as-code-security>
- Перенос безопасности облака влево с помощью Infrastructure as Code: <https://securityboulevard.com/2020/04/shifting-cloud-security-left-with-infrastructure-as-code/>
