# Шпаргалка по логированию

## Введение

Эта шпаргалка предназначена для предоставления разработчикам концентрированных рекомендаций по построению механизмов ведения логов приложений, особенно в части, касающейся безопасности.

Во многих системах ведение логов сетевых устройств, операционных систем, веб-серверов, почтовых серверов и серверов баз данных включено, но часто отсутствует, отключено или плохо настроено ведение логов пользовательских событий приложений. Оно предоставляет гораздо больше информации, чем просто инфраструктурное ведение логов. Ведение логов веб-приложений (например, веб-сайта или веб-службы) — это нечто большее, чем просто включение логов веб-сервера (например, с использованием Расширенного Формата Логов (Extended Log File Format)).

Ведение логов приложений должно быть единообразным в рамках приложения, единообразным по всему портфолио приложений организации и использовать отраслевые стандарты там, где это уместно, чтобы данные о событиях, записанные в логах, могли быть использованы, коррелированы, проанализированы и управляемы широким спектром систем.

## Цель

Ведение логов приложений всегда должно включаться для событий безопасности. Логи приложений являются бесценными данными для:

- Определения инцидентов безопасности
- Мониторинга нарушений политик
- Установления базовых показателей
- Поддержки механизмов неотказуемости (обратите внимание, что свойство неотказуемости трудно достичь для логов, поскольку их достоверность часто основывается лишь на надлежащем аудите стороны, ведущей логирование, в то время как механизмы, такие как цифровые подписи, здесь сложно использовать)
- Предоставления информации о проблемах и необычных условиях
- Внесения дополнительной специфичной для приложения информации для расследования инцидентов, которая отсутствует в других источниках логов
- Помощи в защите от идентификации уязвимостей и эксплуатации через обнаружение атак

Логирование приложений также может использоваться для записи других типов событий, таких как:

- События безопасности
- Мониторинг бизнес-процессов, например, прекращение процесса продаж, транзакции, соединения
- Мониторинг антиавтоматизации
- Аудиторские следы, например, добавление, изменение и удаление данных, экспорт данных
- Мониторинг производительности, например, время загрузки данных, таймауты страницы
- Мониторинг соответствия
- Данные для последующих запросов на информацию, например, доступ субъектов данных, запросы в рамках свободы информации, судебные разбирательства, полицейские и другие регуляторные расследования
- Законно санкционированное перехватывание данных, например, перехват на уровне приложения
- Другие специфичные для бизнеса требования

Мониторинг процессов, аудит, и журналы транзакций и т.д. обычно собираются для других целей, чем ведение логов событий безопасности, и это часто означает, что они должны храниться отдельно.

Типы событий и собранные детали будут различаться.

Например, аудиторский журнал [PCIDSS](https://www.pcisecuritystandards.org/pci_security/) будет содержать хронологическую запись действий, чтобы предоставить независимо проверяемую трассу, которая позволяет восстановление, обзор и изучение для определения исходной последовательности атрибутивных транзакций. Важно не записывать слишком много или слишком мало.

Используйте знание предполагаемых целей, чтобы направлять, что, когда и сколько нужно записывать. Остальная часть этого шпаргалки в первую очередь обсуждает ведение логов событий безопасности.

## Проектирование, реализация и тестирование

### Источники данных о событиях

Само приложение имеет доступ к широкому диапазону информационных событий, которые следует использовать для создания записей в логе. Таким образом, основным источником данных о событиях является сам код приложения.

Приложение обладает наибольшим количеством информации о пользователе (например, идентификация, роли, разрешения) и контексте события (цель, действие, результаты), и часто эти данные недоступны ни устройствам инфраструктуры, ни даже близко связанным приложениям.

Другие источники информации об использовании приложения, которые также могут быть рассмотрены:

- Программное обеспечение клиента, например, действия на настольном ПО и мобильных устройствах в локальных логах или с использованием технологий обмена сообщениями, обработчик исключений JavaScript через Ajax, веб-браузер, например, с использованием механизма отчетности Политики Безопасности Контента (Content Security Policy, CSP)
- Встроенный код инструментирования
- Сетевые межсетевые экраны
- Системы обнаружения вторжений на уровне сети и хоста (NIDS и HIDS)
- Тесно связанные приложения, например, фильтры, встроенные в программное обеспечение веб-сервера, перенаправления/переписывания URL веб-сервера на скриптовые страницы ошибок и обработчики
- Межсетевые экраны приложений, например, фильтры, стражи, XML-шлюзы, межсетевые экраны баз данных, межсетевые экраны веб-приложений (WAF)
- Приложения базы данных, например, автоматические аудиторские следы, действия, основанные на триггерах
- Сервисы мониторинга репутации, например, мониторинг времени работы или обнаружения вредоносного ПО
- Другие приложения, например, мониторинг мошенничества, CRM
- Операционные системы, например, мобильные платформы

Необходимо учитывать степень доверия к информации о событиях при включении данных о событиях из систем в другой зоне доверия. Данные могут отсутствовать, быть измененными, подделанными, повторно воспроизведенными и могут быть зловредными – их всегда следует рассматривать как ненадежные данные.

Рассмотрите, как может быть проверен источник, и как могут быть обеспечены целостность и неотказуемость.

### Где записывать данные о событиях

Приложения обычно записывают данные журнала событий в файловую систему или базу данных (SQL или NoSQL). Приложения, установленные на настольных компьютерах и мобильных устройствах, могут использовать локальное хранилище и локальные базы данных, а также отправлять данные в удаленное хранилище.

Ваш выбранный фреймворк может ограничивать доступные варианты. Все типы приложений могут отправлять данные о событиях на удаленные системы (вместо или дополнительно к более локальному хранению).

Это может быть централизованная система сбора и управления логами (например, SIEM или SEM) или другое приложение в другом месте. Рассмотрите возможность, может ли приложение просто отправить свой поток событий, необработанный, в stdout, для управления средой выполнения.

- При использовании файловой системы предпочтительно использовать отдельный раздел, нежели те, которые используются операционной системой, другими файлами приложений и контентом, создаваемым пользователями.
    - Для логов на основе файлов применяйте строгие разрешения относительно того, какие пользователи могут получать доступ к каталогам и какие разрешения на файлы внутри каталогов.
    - В веб-приложениях логи не должны быть доступны в веб-доступных местах, и если это сделано, они должны иметь ограниченный доступ и быть настроены с MIME-типом простого текста (не HTML).
- При использовании базы данных предпочтительно использовать отдельную учетную запись базы данных, которая используется только для записи данных лога и имеет очень ограниченные разрешения базы данных, таблиц, функций и команд.
- Используйте стандартные форматы по защищенным протоколам для записи и отправки данных о событиях или файлов логов на другие системы, например, Common Log File System (CLFS) или Common Event Format (CEF) через syslog; стандартные форматы облегчают интеграцию с централизованными сервисами логирования.

Рассмотрите использование отдельных файлов/таблиц для расширенной информации о событиях, таких как трассы ошибок или запись заголовков и тел HTTP-запросов и ответов.

### Какие события логировать

Уровень и содержание мониторинга безопасности, оповещения и отчетности должны быть установлены на этапе требований и проектирования проектов и должны соответствовать рискам информационной безопасности. Это затем можно использовать для определения того, что следует логировать.

Нет универсального решения, и слепой подход с чек-листом может привести к ненужному "туману тревог", из-за которого реальные проблемы остаются невыявленными.

Где это возможно, всегда логируйте:

- Сбои проверки входных данных, например, нарушения протоколов, неприемлемые кодировки, недопустимые имена и значения параметров
- Сбои проверки выходных данных, например, несоответствие набора записей базы данных, недопустимая кодировка данных
- Успехи и неудачи аутентификации
- Отказы авторизации (контроля доступа)
- Сбои управления сессиями, например, изменение значения идентификации cookie сессии или подозрительные сбои валидации JWT
- Ошибки приложения и системные события, например, синтаксические и ошибки времени выполнения, проблемы с подключением, проблемы с производительностью, сообщения об ошибках сторонних сервисов, ошибки файловой системы, обнаружение вирусов при загрузке файлов, изменения конфигурации
- Запуски и остановки приложения и связанных систем, а также инициализация логирования (запуск, остановка или приостановка)
- Использование функций с повышенным риском, включая:
    - Действия по администрированию пользователей, такие как добавление или удаление пользователей, изменение привилегий, назначение пользователей токенам, добавление или удаление токенов
    - Использование системных административных привилегий или доступ администраторов приложений, включая все действия этих пользователей
    - Использование учетных записей по умолчанию или общих учетных записей или "экстренной" учетной записи
    - Доступ к конфиденциальным данным, таким как данные держателей платежных карт
    - Действия по шифрованию, такие как использование или ротация криптографических ключей
    - Создание и удаление объектов уровня системы
    - Импорт и экспорт данных, включая экранные отчеты
    - Отправка и обработка контента, созданного пользователями — особенно загрузка файлов
    - Сбои десериализации
    - Сетевые подключения и связанные с ними сбои, такие как сбои TLS на заднем плане (включая сбои проверки сертификатов) или запросы с неожиданным HTTP-глаголом
- Юридические и другие соглашения, например, разрешения на использование возможностей мобильного телефона, условия использования, соглашения и условия, согласие на использование персональных данных, разрешение на получение маркетинговых коммуникаций
- Подозрительные действия бизнес-логики, такие как:
    - Попытки выполнить набор действий вне порядка/обойти управление потоком
    - Действия, которые не имеют смысла в бизнес-контексте
    - Попытки превысить ограничения для конкретных действий

Опциональные события для логирования и желательность их логирования:

- Сбой последовательности
- Чрезмерное использование
- Изменения данных
- Мошенничество и другие преступные действия
- Подозрительное, неприемлемое или неожиданное поведение
- Изменения конфигурации
- Изменения файлов кода приложения и/или памяти

### Атрибуты события

Каждая запись в логе должна включать достаточную информацию для последующего мониторинга и анализа. Это может быть полное содержимое данных, но чаще всего это будет извлечение или только сводные свойства.

Логи приложения должны фиксировать "когда, где, кто и что" для каждого события.

Свойства этих данных будут различаться в зависимости от архитектуры, класса приложения и системы/устройства хоста, но часто включают следующее:

- Когда
    - Дата и время записи лога (международный формат)
    - Дата и время события — метка времени события может отличаться от времени логирования, например, запись логов на сервере, где клиентское приложение размещено на удаленном устройстве, которое только периодически или временно находится в сети
    - Идентификатор взаимодействия `Примечание A`
- Где
    - Идентификатор приложения, например, название и версия
    - Адрес приложения, например, кластер/hostname или IPv4 или IPv6-адрес сервера и номер порта, идентификатор рабочей станции, локальный идентификатор устройства
    - Сервис, например, имя и протокол
    - Геолокация
    - Окно/форма/страница, например, URL начальной точки и HTTP-метод для веб-приложения, имя диалогового окна
    - Местоположение кода, например, имя скрипта, имя модуля
- Кто (пользователь-человек или машина)
    - Исходный адрес, например, идентификатор устройства пользователя/машины, IP-адрес пользователя, ID вышки сотовой связи/РЧ, номер мобильного телефона
    - Идентификатор пользователя (если аутентифицирован или известен другим образом), например, значение первичного ключа в таблице пользователей базы данных, имя пользователя, номер лицензии
- Что
    - Тип события `Примечание B`
    - Важность события `Примечание B`, например, `{0=чрезвычайная ситуация, 1=предупреждение, ..., 7=отладка}, {фатальная ошибка, ошибка, предупреждение, информация, отладка, трассировка}`
    - Флаг события, относящегося к безопасности (если логи содержат и данные о не связанных с безопасностью событиях)
    - Описание

Также рассмотрите возможность записи следующего:

- Вспомогательный источник времени (например, GPS), дата и время события
- Действие — исходная цель запроса, например, вход в систему, обновление ID сессии, выход из системы, обновление профиля
- Объект, например, затронутый компонент или другой объект (учетная запись пользователя, ресурс данных, файл), например, URL, ID сессии, учетная запись пользователя, файл
- Статус результата — был ли ДЕЙСТВИЕ по ОБЪЕКТУ успешным, например, Успех, Ошибка, Отложено
- Причина — почему произошел указанный выше статус, например, Пользователь не аутентифицирован в базе данных..., Неверные учетные данные
- HTTP статус-код (только для веб-приложений) — статус-код, возвращаемый пользователю (часто 200 или 301)
- HTTP заголовки запроса или HTTP User-Agent (только для веб-приложений)
- Классификация типа пользователя, например, публичный, аутентифицированный пользователь, пользователь CMS, поисковая система, авторизованный тестировщик на проникновение, монитор времени работы (см. "Данные для исключения" ниже)
- Доверие к аналитической оценке события `Примечание B`, например, низкий, средний, высокий или числовое значение
- Ответы, видимые пользователю и/или принятые приложением, например, статус-код, пользовательские текстовые сообщения, завершение сессии, уведомления администратора
- Расширенные детали, например, трассировка стека, системные сообщения об ошибках, отладочная информация, тело HTTP-запроса, заголовки и тело HTTP-ответа
- Внутренние классификации, например, ответственность, ссылки на соответствие требованиям
- Внешние классификации, например, NIST Security Content Automation Protocol (SCAP), Mitre Common Attack Pattern Enumeration and Classification (CAPEC)

Для получения дополнительной информации по этим вопросам см. "другие" связанные статьи, приведенные в конце, особенно исчерпывающую статью Антона Чувакина и Гуннара Петерсона.

**Примечание A:** "Идентификатор взаимодействия" — это метод связывания всех (релевантных) событий для одного взаимодействия пользователя (например, отправка формы в настольном приложении, запрос веб-страницы, нажатие кнопки в мобильном приложении, вызов веб-службы). Приложение знает, что все эти события относятся к одному взаимодействию, и это должно быть записано, вместо того чтобы терять информацию и заставлять последующие корреляционные техники восстанавливать отдельные события. Например, один SOAP-запрос может иметь несколько сбоев проверки входных данных, и они могут охватывать небольшой промежуток времени. В другом примере сбой проверки выходных данных может произойти гораздо позже, чем отправка входных данных, для долгосрочного "запроса саги", отправленного приложением на сервер базы данных.

**Примечание B:** Каждая организация должна обеспечить наличие согласованного и задокументированного подхода к классификации событий (тип, уверенность, важность), синтаксису описаний, а также длинам полей и типам данных, включая формат, используемый для дат/времени.

### Данные для исключения

Никогда не логируйте данные, если это не законно. Например, перехват некоторых сообщений, мониторинг сотрудников и сбор некоторых данных без согласия могут быть незаконными.

Никогда не исключайте события от "известных" пользователей, таких как другие внутренние системы, "доверенные" третьи стороны, роботы поисковых систем, системы мониторинга времени работы/процессов и другие удаленные системы мониторинга, тестировщики на проникновение, аудиторы. Однако вы можете включить классификационный флаг для каждого из них в записываемых данных.

Следующее обычно не должно записываться напрямую в логах, а вместо этого должно быть удалено, замаскировано, очищено, хешировано или зашифровано:

- Исходный код приложения
- Значения идентификации сессии (рассмотрите возможность замены на хешированное значение, если необходимо отслеживать события, относящиеся к конкретной сессии)
- Токены доступа
- Конфиденциальные личные данные и некоторые формы персональной идентифицируемой информации (PII), например, здоровье, государственные идентификаторы, уязвимые люди
- Пароли аутентификации
- Строки подключения к базе данных
- Ключи шифрования и другие первичные секреты
- Данные банковских счетов или данные держателей платежных карт
- Данные более высокого уровня безопасности, чем разрешено хранить системе логирования
- Коммерчески конфиденциальная информация
- Информация, которую запрещено собирать в соответствующих юрисдикциях
- Информация, от сбора которой пользователь отказался или не дал согласие, например, использование "do not track", или когда истек срок действия согласия на сбор данных

Иногда также может существовать следующая информация, и, хотя она полезна для последующего расследования, ее также может потребоваться обработать особым образом перед записью события:

- Пути к файлам
- Строки подключения к базе данных
- Внутренние сетевые имена и адреса
- Несекретные персональные данные (например, личные имена, телефонные номера, адреса электронной почты)

Рассмотрите возможность использования методов деидентификации персональных данных, таких как удаление, смешивание или псевдонимизация прямых и косвенных идентификаторов в случаях, когда идентификация личности не требуется или риск считается слишком высоким.

В некоторых системах очистка данных может быть выполнена после сбора логов и перед их отображением.

### Настраиваемое логирование

Может быть целесообразно возможность изменения уровня логирования (тип событий на основе уровня угрозы или важности, количество записываемых данных). Если это реализовано, убедитесь, что:

- Уровень по умолчанию должен обеспечивать достаточную детализацию для нужд бизнеса
- Невозможно полностью отключить ведение логов приложений или событий, необходимых для соответствия требованиям
- Изменения уровня/объема логирования должны быть неотъемлемой частью приложения (например, выполняться автоматически приложением на основе утвержденного алгоритма) или следовать процессам управления изменениями (например, изменения в данных конфигурации, модификация исходного кода)
- Уровень логирования должен периодически проверяться

### Сбор событий

Если ваш фреймворк разработки поддерживает подходящие механизмы логирования, используйте их или стройте на их основе. В противном случае реализуйте универсальный обработчик логов, который можно вызывать из других модулей/компонентов.

Документируйте интерфейс, ссылаясь на требования к синтаксису классификации событий и их описания, специфичные для организации.

Если возможно, создайте этот обработчик логов в виде стандартного модуля, который можно тщательно протестировать, развернуть в нескольких приложениях и добавить в список одобренных и рекомендованных модулей.

- Выполняйте проверку входных данных о событиях из других зон доверия, чтобы убедиться, что они имеют правильный формат (и рассматривайте возможность оповещения и не логирования при ошибке проверки входных данных)
- Выполняйте очистку всех данных событий, чтобы предотвратить атаки на инъекции в логи, например, удаление символов возврата каретки (CR), перевода строки (LF) и разделителей (и, возможно, удаление конфиденциальных данных)
- Правильно кодируйте данные для формата вывода (лога)
- Если данные записываются в базу данных, прочитайте, поймите и примените шпаргалку по инъекциям SQL
- Убедитесь, что сбои в процессах/системах логирования не препятствуют работе приложения или не допускают утечки информации
- Синхронизируйте время на всех серверах и устройствах `Примечание C`

**Примечание C:** Это не всегда возможно, когда приложение работает на устройстве под контролем другой стороны (например, на мобильном телефоне пользователя, на удаленной рабочей станции клиента, которая находится в другой корпоративной сети). В этих случаях попытайтесь измерить смещение времени или записать уровень доверия к метке времени события.

По возможности записывайте данные в стандартном формате или, по крайней мере, убедитесь, что они могут быть экспортированы/транслированы с использованием стандартизированного формата.

В некоторых случаях события могут быть переданы или собраны в промежуточных точках. В последнем случае некоторые данные могут быть агрегированы или обобщены перед передачей в центральное хранилище и систему анализа.

### Проверка

Функциональность логирования и системы должны включаться в процессы обзора кода, тестирования приложения и проверки безопасности:

- Убедитесь, что логирование работает правильно и в соответствии с требованиями
- Проверьте, что события классифицируются последовательно и имена полей, типы и длины корректно определены в соответствии с утвержденным стандартом
- Убедитесь, что логирование включено и включено во время тестирования безопасности приложения, фуззинг-тестирования, тестирования на проникновение и тестирования производительности
- Проверьте, что механизмы не подвержены атакам инъекций
- Убедитесь, что при логировании не возникает нежелательных побочных эффектов
- Проверьте эффект на механизмы логирования при потере внешнего сетевого подключения (если это обычно требуется)
- Убедитесь, что логирование не может быть использовано для истощения ресурсов системы, например, заполнения дискового пространства или превышения объема журнала транзакций базы данных, что приводит к отказу в обслуживании
- Проверьте эффект на приложение от сбоев логирования, таких как имитация потери соединения с базой данных, нехватка места на файловой системе, отсутствие прав на запись в файловую систему и ошибки времени выполнения в самом модуле логирования
- Проверьте контроль доступа к данным журналов событий
- Если данные журнала используются в каких-либо действиях против пользователей (например, блокирование доступа, блокировка учетной записи), убедитесь, что это не может быть использовано для создания отказа в обслуживании (DoS) других пользователей

### Сетевая архитектура

Как пример, диаграмма ниже показывает сервис, предоставляющий бизнес-функциональность клиентам. Мы рекомендуем создать централизованную систему для сбора логов. Может быть множество таких сервисов, но все они должны безопасно собирать логи в централизованной системе.

Приложения этого бизнес-сервиса расположены в сетевых сегментах:

- FRONTEND 1 также известен как DMZ (пользовательский интерфейс)
- MIDDLEWARE 1 (бизнес-приложение — ядро сервиса)
- BACKEND 1 (база данных сервиса)

Сервис, ответственный за сбор событий ИТ, включая события безопасности, находится в следующих сегментах:

- BACKEND 2 (хранилище логов)
- MIDDLEWARE 3 - 2 приложения:
    - приложение загрузчика логов, которое загружает логи из хранилища, предварительно обрабатывает и передает в UI
    - сборщик логов, который принимает логи от бизнес-приложений, другой инфраструктуры, облачных приложений и сохраняет их в хранилище логов
- FRONTEND 2 (интерфейс пользователя для просмотра журналов событий бизнес-сервиса)
- FRONTEND 3 (приложения, которые получают логи от облачных приложений и передают логи в сборщик логов)
    - Допускается совмещение функций двух приложений в одном

Например, все внешние запросы от пользователей проходят через сервис управления API, см. приложение в сегменте MIDDLEWARE 2.

![MIDDLEWARE](https://raw.githubusercontent.com/OWASP/CheatSheetSeries/master/assets/Logging_Cheat_Sheet.drawio.png)

Как видно на изображении выше, на сетевом уровне процессы сохранения и загрузки логов требуют открытия различных сетевых доступов (портов), стрелки выделены разными цветами. Также сохранение и загрузка выполняются разными приложениями.

Полная шпаргалка по сетевой сегментации от [sergiomarotco](https://github.com/sergiomarotco): [ссылка](https://github.com/sergiomarotco/Network-segmentation-cheat-sheet)

## Развертывание и эксплуатация

### Выпуск

- Предоставьте информацию о конфигурации безопасности, добавив подробности о механизмах логирования в документацию по выпуску
- Ознакомьте владельца приложения/процесса с механизмами логирования приложения
- Убедитесь, что результаты мониторинга (см. ниже) интегрированы с процессами реагирования на инциденты

### Эксплуатация

Включите процессы для обнаружения остановки логирования, а также для выявления фальсификаций или несанкционированного доступа и удаления (см. защиту ниже).

### Защита

Механизмы логирования и собранные данные о событиях должны быть защищены от неправомерного использования, такого как фальсификация при передаче, несанкционированный доступ, модификация и удаление после хранения. Логи могут содержать личную и другую конфиденциальную информацию, или данные могут содержать информацию о коде и логике приложения.

Кроме того, собранная информация в логах может сама по себе иметь ценность для бизнеса (для конкурентов, распространителей слухов, журналистов и активистов), например, позволять оценить доходы или предоставить информацию о производительности сотрудников.

Эти данные могут храниться на конечных устройствах, в промежуточных точках, в централизованных репозиториях и в архивах и резервных копиях.

Рассмотрите возможность исключения, маскирования, очистки, хеширования или шифрования некоторых данных во время их анализа или извлечения.

В состоянии покоя:

- Встроите обнаружение изменений, чтобы знать, если запись была изменена или удалена
- Сохраняйте или копируйте данные логов на носители только для чтения как можно быстрее
- Весь доступ к логам должен быть записан и мониториться (и может потребовать предварительного одобрения)
- Привилегии на чтение данных логов должны быть ограничены и периодически пересматриваться

При передаче:

- Если данные логов передаются по ненадежным сетям (например, для сбора, отправки в другое место, анализа, отчетности), используйте протокол защищенной передачи
- Рассмотрите необходимость проверки источника данных о событиях
- Выполняйте проверки надлежащей добросовестности (регулирования и безопасности) перед отправкой данных о событиях третьим сторонам

См. руководство `NIST SP 800-92` по управлению журналами безопасности компьютеров для получения дополнительных рекомендаций.

### Мониторинг событий

Данные событий, записанные в логах, должны быть доступны для просмотра, и должны существовать процессы для надлежащего мониторинга, оповещения и отчетности:

- Интегрируйте логирование приложения в существующие системы/инфраструктуру управления логами, например, централизованные системы логирования и анализа
- Убедитесь, что информация о событиях доступна соответствующим командам
- Включите оповещения и немедленно уведомите ответственные команды о более серьезных событиях
- Делитесь релевантной информацией о событиях с другими системами обнаружения, с родственными организациями и централизованными системами сбора и обмена информацией

### Удаление логов

Данные журналов, временные журналы отладки, резервные копии/копии/извлечения не должны уничтожаться до истечения требуемого периода хранения данных и не должны храниться дольше этого времени.

Юридические, регуляторные и договорные обязательства могут влиять на эти сроки.

## Атаки на логи

Поскольку они полезны как средство защиты, логи могут стать целью атак. См. также OWASP [Log Injection](https://owasp.org/www-community/attacks/Log_Injection) и [CWE-117](https://cwe.mitre.org/data/definitions/117.html).

### Конфиденциальность

Кто должен иметь доступ к чтению чего? Атака на конфиденциальность позволяет несанкционированной стороне получить доступ к конфиденциальной информации, хранящейся в логах.

- Логи содержат персональные данные пользователей. Злоумышленники собирают персональные данные, а затем либо публикуют их, либо используют в качестве трамплина для дальнейших атак на этих пользователей.
- Логи содержат технические секреты, такие как пароли. Злоумышленники используют их в качестве трамплина для более глубоких атак.

### Целостность

Какая информация должна быть доступна для изменения и кем?

- Злоумышленник с доступом к чтению лога использует его для кражи секретов.
- Атака использует логи для соединения с уязвимыми элементами платформы логирования, например, отправляя полезную нагрузку через syslog для создания записи за пределами допустимого.

### Доступность

Какое время простоя допустимо?

- Злоумышленник заполняет файлы логов, чтобы исчерпать доступное дисковое пространство для других функций системы, не связанных с логированием. Например, тот же диск, который используется для файлов логов, может использоваться для хранения данных SQL приложения.
- Злоумышленник заполняет файлы логов, чтобы исчерпать доступное дисковое пространство для дальнейшего логирования.
- Злоумышленник использует одну запись в логе, чтобы уничтожить другие записи.
- Злоумышленник использует плохую производительность кода логирования для уменьшения производительности приложения.

### Ответственность

Кто несет ответственность за ущерб?

- Злоумышленник предотвращает запись, чтобы скрыть свои следы.
- Злоумышленник повреждает лог, чтобы скрыть свои следы.
- Злоумышленник заставляет логироваться неверную личность, чтобы скрыть ответственное лицо.

## Связанные статьи

- OWASP [Документация ESAPI](https://owasp.org/www-project-enterprise-security-api/).
- OWASP [Logging Project](https://owasp.org/www-project-security-logging/).
- IETF [syslog protocol](https://tools.ietf.org/rfc/rfc5424.txt).
- Mitre [Common Event Expression (CEE)](http://cee.mitre.org/) (as of 2014 no longer actively developed).
- NIST [SP 800-92 Guide to Computer Security Log Management](http://csrc.nist.gov/publications/nistpubs/800-92/SP800-92.pdf).
- PCISSC [PCI DSS v2.0 Requirement 10 and PA-DSS v2.0 Requirement 4](https://www.pcisecuritystandards.org/security_standards/documents.php).
- W3C [Extended Log File Format](http://www.w3.org/TR/WD-logfile.html).
- Other [Build Visibility In, Richard Bejtlich, TaoSecurity blog](http://taosecurity.blogspot.co.uk/2009/08/build-visibility-in.html).
- Other [Common Event Format (CEF), Arcsight](https://community.microfocus.com/t5/ArcSight-Connectors/ArcSight-Common-Event-Format-CEF-Implementation-Standard/ta-p/1645557).
- Other [Log Event Extended Format (**LEEF**), IBM](https://www.ibm.com/developerworks/community/wikis/form/anonymous/api/wiki/9989d3d7-02c1-444e-92be-576b33d2f2be/page/3dc63f46-4a33-4e0b-98bf-4e55b74e556b/attachment/a19b9122-5940-4c89-ba3e-4b4fc25e2328/media/QRadar_LEEF_Format_Guide.pdf).
- Other [Common Log File System (CLFS), Microsoft](http://msdn.microsoft.com/en-us/library/windows/desktop/bb986747(v=vs.85).aspx).
- Other [Building Secure Applications: Consistent Logging, Rohit Sethi & Nish Bhalla, Symantec Connect](http://www.symantec.com/connect/articles/building-secure-applications-consistent-logging).
